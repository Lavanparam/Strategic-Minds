<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Minds | Logic Fixed & Expanded</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

        :root {
            --bg-deep: #08080a;
            --card-bg: #111114;
            --accent-primary: #818cf8;
            --accent-success: #10b981;
            --accent-danger: #f43f5e;
            --glass-border: rgba(255, 255, 255, 0.05);
        }

        body {
            background-color: var(--bg-deep);
            color: #d1d5db;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .glass {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
        }

        /* Improved Readability for Strategist */
        .prose-strategist {
            font-size: 1rem;
            line-height: 1.8;
            color: #cbd5e1;
        }
        .prose-strategist h1, .prose-strategist h2, .prose-strategist h3 {
            color: #ffffff;
            font-weight: 800;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }
        .prose-strategist strong { color: #818cf8; font-weight: 700; }
        .prose-strategist ul { margin-bottom: 1.25rem; }
        .prose-strategist li { margin-bottom: 0.5rem; padding-left: 1.5rem; position: relative; }
        .prose-strategist li::before { content: "‚Ä¢"; position: absolute; left: 0; color: #818cf8; }

        .matrix-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        .matrix-cell {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 1rem;
        }

        .chart-container { position: relative; width: 100%; height: 220px; }

        .loader {
            width: 20px; height: 20px;
            border: 2px solid rgba(129, 140, 248, 0.1);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .btn-game {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-game:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
    </style>
</head>
<body class="antialiased">

    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-8 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center font-bold text-white shadow-lg">Œ£</div>
                <span class="text-lg font-black tracking-tighter uppercase text-white">Strategic <span class="text-indigo-500">Minds</span></span>
            </div>
            <div class="flex space-x-2 bg-black/40 p-1 rounded-xl border border-white/10">
                <button onclick="switchTab('sim')" id="tab-sim" class="px-5 py-2 rounded-lg text-xs font-bold transition bg-indigo-600 text-white shadow-lg">SIMULATION</button>
                <button onclick="switchTab('library')" id="tab-library" class="px-5 py-2 rounded-lg text-xs font-bold transition text-gray-400 hover:text-white">LIBRARY</button>
                <button onclick="switchTab('lab')" id="tab-lab" class="px-5 py-2 rounded-lg text-xs font-bold transition text-gray-400 hover:text-white">LABORATORY</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-8 py-10 space-y-10">
        
        <!-- SECTION: SIMULATION -->
        <div id="view-sim" class="space-y-8 animate-in fade-in duration-500">
            
            <!-- Strategic Matrix & Info -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-7 glass p-10 rounded-[2.5rem] flex flex-col justify-between">
                    <div class="space-y-4">
                        <div class="flex items-center space-x-2 text-indigo-400">
                            <span id="game-icon" class="text-2xl">‚öñÔ∏è</span>
                            <span class="text-[10px] font-black uppercase tracking-[0.2em]">Live Protocol</span>
                        </div>
                        <h2 id="briefing-title" class="text-4xl font-black text-white">Prisoner's Dilemma</h2>
                        <p id="briefing-desc" class="text-gray-400 leading-relaxed text-sm">Loading briefing context...</p>
                    </div>

                    <div class="pt-8 mt-8 border-t border-white/5">
                        <div class="flex justify-between items-end mb-4">
                            <h3 class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Payoff Matrix</h3>
                            <span class="text-[10px] text-gray-600 italic">Score: (You, Bot)</span>
                        </div>
                        <div class="matrix-grid">
                            <div class="matrix-cell">
                                <div class="text-[9px] font-bold text-emerald-500 uppercase mb-1" id="m-cc-label">Both Cooperate</div>
                                <div id="m-cc-val" class="text-lg font-bold text-white mono">0, 0</div>
                            </div>
                            <div class="matrix-cell">
                                <div class="text-[9px] font-bold text-rose-500 uppercase mb-1" id="m-dd-label">Both Defect</div>
                                <div id="m-dd-val" class="text-lg font-bold text-white mono">0, 0</div>
                            </div>
                            <div class="matrix-cell">
                                <div class="text-[9px] font-bold text-indigo-400 uppercase mb-1" id="m-dc-label">You Exploit</div>
                                <div id="m-dc-val" class="text-lg font-bold text-white mono">0, 0</div>
                            </div>
                            <div class="matrix-cell">
                                <div class="text-[9px] font-bold text-gray-500 uppercase mb-1" id="m-cd-label">You Are Sucker</div>
                                <div id="m-cd-val" class="text-lg font-bold text-white mono">0, 0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-5 glass p-10 rounded-[2.5rem] bg-gradient-to-b from-white/[0.02] to-transparent flex flex-col justify-between">
                    <div class="space-y-6">
                        <h3 class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em]">Game Parameters</h3>
                        <div class="space-y-4">
                            <div class="space-y-2">
                                <label class="text-[9px] text-gray-500 font-bold uppercase ml-1">Select Model</label>
                                <select id="game-selector" onchange="updateGameContext()" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                    <option value="pd">Prisoner's Dilemma</option>
                                    <option value="chicken">Game of Chicken</option>
                                    <option value="staghunt">Stag Hunt</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[9px] text-gray-500 font-bold uppercase ml-1">Opponent Brain</label>
                                <select id="strat-selector" onchange="resetGame()" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                    <option value="titfortat">Tit-for-Tat (Reciprocal)</option>
                                    <option value="grudger">Grim Trigger (Unforgiving)</option>
                                    <option value="always_defect">Predatory (Always Defect)</option>
                                    <option value="random">Chaotic (Random)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="pt-8 grid grid-cols-2 gap-4 border-t border-white/5">
                        <div class="text-center">
                            <div class="text-[9px] text-gray-500 uppercase font-black">Your Assets</div>
                            <div id="p1-score" class="text-4xl font-black text-indigo-400 mt-1 mono">0</div>
                        </div>
                        <div class="text-center border-l border-white/5">
                            <div class="text-[9px] text-gray-500 uppercase font-black">Bot Assets</div>
                            <div id="p2-score" class="text-4xl font-black text-rose-500 mt-1 mono">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Interaction Section -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Action Buttons & Chart -->
                <div class="lg:col-span-8 glass p-10 rounded-[3rem] space-y-10">
                    <div id="outcome-banner" class="text-center text-gray-500 h-6 font-medium italic">
                        Select an action to initiate iteration.
                    </div>

                    <div class="flex items-center justify-center gap-10">
                        <div class="flex flex-col items-center space-y-3">
                            <button onclick="playRound('cooperate')" class="btn-game w-32 h-32 bg-emerald-500/10 border border-emerald-500/20 rounded-[2.5rem] flex items-center justify-center text-5xl hover:bg-emerald-500 hover:text-white shadow-xl shadow-emerald-500/5">ü§ù</button>
                            <span class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Cooperate</span>
                        </div>
                        <div class="text-gray-800 font-black text-2xl">VS</div>
                        <div class="flex flex-col items-center space-y-3">
                            <button onclick="playRound('defect')" class="btn-game w-32 h-32 bg-rose-500/10 border border-rose-500/20 rounded-[2.5rem] flex items-center justify-center text-5xl hover:bg-rose-500 hover:text-white shadow-xl shadow-rose-500/5">‚öîÔ∏è</button>
                            <span class="text-[10px] font-black text-rose-500 uppercase tracking-widest">Defect</span>
                        </div>
                    </div>

                    <div class="pt-10 border-t border-white/5">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-[10px] font-black text-gray-600 uppercase tracking-widest">Accumulated Payoff History</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-[10px] text-gray-500">Rounds: <span id="round-count" class="text-white font-bold mono">0</span></span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Strategist Section (Improved Readability) -->
                <div class="lg:col-span-4 glass p-8 rounded-[3rem] border-indigo-500/20 flex flex-col shadow-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em] flex items-center">
                            <span class="mr-2 text-lg">‚ú®</span> Behavioral Strategist
                        </h3>
                        <div id="ai-status" class="hidden"><div class="loader"></div></div>
                    </div>
                    
                    <div id="ai-response-box" class="flex-grow prose-strategist overflow-y-auto max-h-[450px] pr-2 custom-scroll">
                        <p class="italic text-gray-500 text-sm py-20 text-center">Analysis requires 5 rounds of interaction data.</p>
                    </div>

                    <button id="analyze-btn" disabled onclick="requestAIAnalysis()" class="mt-6 w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-2xl text-[10px] uppercase tracking-widest transition shadow-lg shadow-indigo-600/20 disabled:opacity-20">
                        Launch Behavioral Mapping
                    </button>
                    <button onclick="resetGame()" class="mt-4 w-full text-[10px] font-bold text-gray-600 hover:text-white uppercase transition tracking-widest">
                        Purge Session Data
                    </button>
                </div>
            </div>
        </div>

        <!-- SECTION: LIBRARY (IMPLEMENTED) -->
        <div id="view-library" class="hidden space-y-12 animate-in slide-in-from-bottom-5 duration-500">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                <div class="lg:col-span-2 space-y-8">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-black text-white">Strategy Journal</h2>
                        <button onclick="clearJournal()" class="text-xs text-gray-600 hover:text-rose-500 uppercase font-bold tracking-widest">Clear Records</button>
                    </div>
                    <div id="journal-container" class="space-y-6">
                        <!-- History items populated here -->
                    </div>
                </div>
                <div class="lg:col-span-1 space-y-8">
                    <h2 class="text-3xl font-black text-indigo-400">Tactical Database</h2>
                    <div id="tactical-db" class="space-y-4">
                        <!-- Strategy definitions -->
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION: LAB -->
        <div id="view-lab" class="hidden animate-in slide-in-from-bottom-5 duration-500">
            <div class="max-w-4xl mx-auto glass p-12 rounded-[3.5rem] space-y-8">
                <h2 class="text-3xl font-black text-white">Scenario Mapping</h2>
                <textarea id="lab-input" placeholder="Describe a real-world conflict to map its game-theoretic properties..." class="w-full h-56 bg-black/60 border border-white/5 rounded-[2rem] p-8 text-white focus:ring-4 focus:ring-indigo-500/10 outline-none transition resize-none text-lg"></textarea>
                <div class="flex justify-between">
                    <button onclick="generateRandomScenario()" class="text-xs text-gray-500">Need a prompt?</button>
                    <button onclick="runLabAnalysis()" class="px-12 py-5 bg-indigo-600 text-white font-bold rounded-2xl">Execute Analysis</button>
                </div>
                <div id="lab-result" class="mt-10 bg-black/50 rounded-3xl p-8 border border-white/10 hidden prose-strategist"></div>
            </div>
        </div>

    </main>

    <script>
        // --- GAME DEFINITIONS ---
        const gameBriefings = {
            pd: {
                title: "Prisoner's Dilemma",
                icon: "‚öñÔ∏è",
                desc: "Two accomplices are arrested. If both remain silent (Cooperate), they get light sentences. If one betrays the other (Defect) while the other remains silent, the betrayer goes free. If both betray, both get heavy sentences.",
                labels: ["Stay Silent", "Betray Partner", "Free (Self) / Max (Other)", "Heavy Sentences"],
                payoffs: { cc: [3,3], dd: [1,1], dc: [5,0], cd: [0,5] }
            },
            chicken: {
                title: "Game of Chicken",
                icon: "üèéÔ∏è",
                desc: "Two drivers speed toward each other. The first to swerve (Cooperate) is the 'Chicken'. If neither swerves (Defect), they crash. The highest reward goes to the one who stays straight while the other swerves.",
                labels: ["Both Swerve", "Mutual Crash", "Prestige (Self) / Shame (Other)", "Shame (Self) / Prestige (Other)"],
                payoffs: { cc: [0,0], dd: [-10,-10], dc: [1,-1], cd: [-1,1] }
            },
            staghunt: {
                title: "Stag Hunt",
                icon: "üèπ",
                desc: "Two hunters must trust each other to hunt a Stag (Cooperate). If one hunts a Rabbit (Defect), they get a small guaranteed prize but the Stag escapes, leaving the cooperator with nothing.",
                labels: ["Harvest Stag", "Hunt Rabbits", "Win (Self) / Empty (Other)", "Empty (Self) / Win (Other)"],
                payoffs: { cc: [5,5], dd: [2,2], dc: [3,0], cd: [0,3] }
            }
        };

        const strategyDB = [
            { name: "Tit-for-Tat", text: "Reciprocity. Starts nice, then copies your last move perfectly. Promotes long-term stability." },
            { name: "Grim Trigger", text: "The Punisher. One defection by you causes the bot to defect forever. Unforgiving and dangerous." },
            { name: "Win-Stay, Lose-Shift", text: "Logic-driven. If a move worked, repeat it. If it failed, try the alternative. Also known as Pavlov." }
        ];

        // --- STATE & INITIALIZATION ---
        let gameState = { round: 0, p1Score: 0, p2Score: 0, history: [] };
        let chart = null;

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if(chart) chart.destroy(); // Prevent duplicate charts
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'You', data: [], borderColor: '#818cf8', borderWidth: 3, tension: 0.4, fill: false, pointRadius: 0 },
                        { label: 'Bot', data: [], borderColor: '#f43f5e', borderWidth: 2, borderDash: [5, 5], tension: 0.4, fill: false, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.02)' }, ticks: { color: '#444' } },
                        x: { grid: { display: false }, ticks: { color: '#444' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- CORE LOGIC ---

        function updateGameContext() {
            const type = document.getElementById('game-selector').value;
            const ctx = gameBriefings[type];
            
            document.getElementById('game-icon').innerText = ctx.icon;
            document.getElementById('briefing-title').innerText = ctx.title;
            document.getElementById('briefing-desc').innerText = ctx.desc;
            
            // Update Matrix UI
            document.getElementById('m-cc-label').innerText = ctx.labels[0];
            document.getElementById('m-cc-val').innerText = `${ctx.payoffs.cc[0]}, ${ctx.payoffs.cc[1]}`;
            document.getElementById('m-dd-label').innerText = ctx.labels[1];
            document.getElementById('m-dd-val').innerText = `${ctx.payoffs.dd[0]}, ${ctx.payoffs.dd[1]}`;
            document.getElementById('m-dc-label').innerText = ctx.labels[2];
            document.getElementById('m-dc-val').innerText = `${ctx.payoffs.dc[0]}, ${ctx.payoffs.dc[1]}`;
            document.getElementById('m-cd-label').innerText = ctx.labels[3];
            document.getElementById('m-cd-val').innerText = `${ctx.payoffs.cd[0]}, ${ctx.payoffs.cd[1]}`;

            resetGame();
        }

        function playRound(playerMove) {
            const gameType = document.getElementById('game-selector').value;
            const strat = document.getElementById('strat-selector').value;
            const lastRound = gameState.history[gameState.history.length - 1];

            // Bot Brain
            let botMove = 'cooperate';
            if (strat === 'random') botMove = Math.random() > 0.5 ? 'cooperate' : 'defect';
            else if (strat === 'always_defect') botMove = 'defect';
            else if (strat === 'titfortat') botMove = lastRound ? lastRound.p1 : 'cooperate';
            else if (strat === 'grudger') botMove = gameState.history.some(h => h.p1 === 'defect') ? 'defect' : 'cooperate';

            const key = (playerMove === 'cooperate' ? 'c' : 'd') + (botMove === 'cooperate' ? 'c' : 'd');
            const pts = gameBriefings[gameType].payoffs[key];

            // Update Logic
            gameState.round++;
            gameState.p1Score += pts[0];
            gameState.p2Score += pts[1];
            gameState.history.push({ p1: playerMove, p2: botMove });

            // Update UI
            document.getElementById('p1-score').innerText = gameState.p1Score;
            document.getElementById('p2-score').innerText = gameState.p2Score;
            document.getElementById('round-count').innerText = gameState.round;

            document.getElementById('outcome-banner').innerHTML = `
                You: <span class="${playerMove==='cooperate'?'text-emerald-400':'text-rose-400'} font-bold">${playerMove.toUpperCase()}</span> | 
                Bot: <span class="${botMove==='cooperate'?'text-emerald-400':'text-rose-400'} font-bold">${botMove.toUpperCase()}</span> | 
                <span class="text-white">+${pts[0]} Score</span>
            `;

            // Update Chart
            chart.data.labels.push(gameState.round);
            chart.data.datasets[0].data.push(gameState.p1Score);
            chart.data.datasets[1].data.push(gameState.p2Score);
            chart.update();

            if (gameState.round >= 5) document.getElementById('analyze-btn').disabled = false;
        }

        function resetGame() {
            gameState = { round: 0, p1Score: 0, p2Score: 0, history: [] };
            document.getElementById('p1-score').innerText = '0';
            document.getElementById('p2-score').innerText = '0';
            document.getElementById('round-count').innerText = '0';
            document.getElementById('outcome-banner').innerText = "Session reset. Ready for protocol.";
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('ai-response-box').innerHTML = `<p class="italic text-gray-500 text-center py-20 text-sm">Interaction threshold: 5 rounds needed.</p>`;
            if (chart) {
                chart.data.labels = [];
                chart.data.datasets.forEach(d => d.data = []);
                chart.update();
            }
        }

        // --- AI ANALYTICS ---

        async function secureAIRequest(prompt, sys) {
            document.getElementById('ai-status').classList.remove('hidden');
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, systemInstruction: sys })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) { return "### Error\nConnection to AI Gateway failed."; }
            finally { document.getElementById('ai-status').classList.add('hidden'); }
        }

        async function requestAIAnalysis() {
            const gameType = document.getElementById('game-selector').value;
            const hist = gameState.history.map(r => `${r.p1[0]}:${r.p2[0]}`).join(', ');
            const system = "You are a Strategic Behavioral Analyst. Analyze the player history in this specific game. Use Markdown with headers. Be insightful and slightly provocative.";
            const prompt = `Game: ${gameBriefings[gameType].title}. Opponent Strategy: ${document.getElementById('strat-selector').value}. History: ${hist}`;
            
            const box = document.getElementById('ai-response-box');
            box.innerHTML = '<div class="loader mx-auto"></div>';
            
            const md = await secureAIRequest(prompt, system);
            box.innerHTML = marked.parse(md);
            saveJournal(gameBriefings[gameType].title, md);
        }

        // --- LIBRARY LOGIC ---

        function saveJournal(title, text) {
            let j = JSON.parse(localStorage.getItem('journal_v4') || "[]");
            j.unshift({ title, text, date: new Date().toLocaleDateString() });
            localStorage.setItem('journal_v4', JSON.stringify(j.slice(0, 15)));
        }

        function clearJournal() { localStorage.removeItem('journal_v4'); renderLibrary(); }

        function renderLibrary() {
            const container = document.getElementById('journal-container');
            const db = document.getElementById('tactical-db');
            const data = JSON.parse(localStorage.getItem('journal_v4') || "[]");

            if(data.length === 0) {
                container.innerHTML = `<div class="glass p-10 text-center text-gray-500 italic rounded-3xl">No historical records found. Run an analysis in the Simulation to begin your journal.</div>`;
            } else {
                container.innerHTML = data.map(item => `
                    <div class="glass p-8 rounded-[2.5rem] space-y-4">
                        <div class="flex justify-between">
                            <h3 class="text-xl font-bold text-white">${item.title} Study</h3>
                            <span class="text-[10px] font-bold text-gray-500">${item.date}</span>
                        </div>
                        <div class="prose-strategist prose-sm">${marked.parse(item.text)}</div>
                    </div>
                `).join('');
            }

            db.innerHTML = strategyDB.map(s => `
                <div class="glass p-5 rounded-2xl border-white/5">
                    <h4 class="font-bold text-white text-sm mb-1">${s.name}</h4>
                    <p class="text-xs text-gray-500">${s.text}</p>
                </div>
            `).join('');
        }

        function switchTab(t) {
            ['sim', 'library', 'lab'].forEach(x => {
                document.getElementById(`view-${x}`).classList.toggle('hidden', x !== t);
                document.getElementById(`tab-${x}`).className = x === t ? "px-5 py-2 rounded-lg text-xs font-bold transition bg-indigo-600 text-white shadow-lg" : "px-5 py-2 rounded-lg text-xs font-bold transition text-gray-400 hover:text-white";
            });
            if (t === 'library') renderLibrary();
        }

        // --- LAB ---
        async function runLabAnalysis() {
            const input = document.getElementById('lab-input').value;
            const res = document.getElementById('lab-result');
            if(!input.trim()) return;
            res.classList.remove('hidden');
            res.innerHTML = '<div class="loader mx-auto"></div>';
            const md = await secureAIRequest(input, "Map this real conflict to Game Theory models. Use Markdown.");
            res.innerHTML = marked.parse(md);
        }

        function generateRandomScenario() {
            const s = ["A co-founder split.", "OPEC oil production quotas.", "Siblings sharing an inheritance.", "Rival smartphone companies standardizing chargers."];
            document.getElementById('lab-input').value = s[Math.floor(Math.random()*s.length)];
        }

        window.onload = () => {
            initChart();
            updateGameContext();
        };
    </script>
</body>
</html>
